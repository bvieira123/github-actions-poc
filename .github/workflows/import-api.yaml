name: import-apiconfig
on:
  push:
    branches:
      - main
jobs:
  import_api:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - name: import graphql definitions
        run: |
          docker run --name apim-cli -e LOG_LEVEL=DEBUG \
          -v ${{ github.workspace }}/graphql-config.json:/graphql-config.json \
          -v ${{ github.workspace }}/schema.graphqls:/schema.graphqls ghcr.io/axway-api-management-plus/apimcli:1.14.4  \
          apim api import -h ${{ vars.APIM_INSTANCE_IP }} -u ${{ vars.APIM_INSTANCE_USER }} -port 8075 \
          -p ${{ secrets.APIM_INSTANCE_PASSWORD }} -c /graphql-config.json
      - name: check if container was run
        run: |
          docker container ls -a
      - name: check container logs
        run: |
          docker logs apim-cli
      - name: cleanup
        run: |
          docker rm apim-cli
      - name: import graphql playground
        run: |
          docker run --name apim-cli -e LOG_LEVEL=DEBUG \
          -v ${{ github.workspace }}/playground-config.json:/playground-config.json \
          -v ${{ github.workspace }}/graphql-playground.json:/graphql-playground.json ghcr.io/axway-api-management-plus/apimcli:1.14.2\
          apim api import -h ${{ vars.APIM_INSTANCE_IP }} -u ${{ vars.APIM_INSTANCE_USER }} -port 8075 \
          -p ${{ secrets.APIM_INSTANCE_PASSWORD }} -c /playground-config.json