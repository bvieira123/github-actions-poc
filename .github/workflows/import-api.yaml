name: import-apiconfig
on:
  push:
    branches:
      - main
jobs:
  import_api:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - name: run apim cli containe
        run: |
          docker run --name apim-cli \
          -v ${{ github.workspace }}/api-config.json:/api-config.json \
          -v ${{ github.workspace }}/graphql.json:/graphql.json \
          ghcr.io/axway-api-management-plus/apimcli:1.14.2  $export LOG_LEVEL=debug && apim api import \
          -apimanagerUrl ${{ secrets.APIM_INSTANCE_IP }} -u ${{ secrets.APIM_INSTANCE_USER }} -p ${{ secrets.APIM_INSTANCE_PASSWORD }} \
          -c ~/api-config.json
      - name: check if container was run
        run: |
          docker container ls -a
      - name: check container logs
        run: |
          docker logs apim-cli
      - name: cleanup
        run: |
          docker rm apim-cli